<html>
<head>
<link rel="stylesheet" href="static/chat.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
</head>
<body>
<script type="text/javascript" charset="utf-8">
const socket = io();

socket.on('connect', () => {
	socket.emit('connected', {'nickname':document.getElementById('nickname-input').value}, (data) => {
	});
});

socket.on('server_message', (data) => {
	let e = document.createElement('p');
	let sp = document.createElement('span');

	sp.innerHTML = data.nickname;
        e.appendChild(sp);

	e.innerHTML = e.innerHTML+' >> '+data.message;
	document.getElementById('message-box').appendChild(e);
	document.getElementById('message-box').scroll(0, document.getElementById('message-box').scrollHeight);
});

function htmlEntities(str) {
    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

function sendMessage(){
	socket.emit('client_message', {'nickname': htmlEntities(document.getElementById('nickname-input').value), 'message':  htmlEntities(document.getElementById('message-input').value)});
	document.getElementById('message-input').value = '';
}
</script>

<div class="container">
  <div class="panel panel-default">
    <div class="panel-heading"><strong>Web Pychat</strong></div>
    <div class="panel-body">
        <section id="message-box"></section>
    </div>
    <div class="panel-footer">
      <div class="input-group">
        <form>
          <input type="text" id="nickname-input" required placeholder="User Name"/>
          <input type="text" id="message-input" required placeholder="Message"/>
          <button type="submit" class="btn btn-sm btn-primary" onclick="sendMessage()">Submit</button>
        </form>
      </div>
    </div>
  </div>
</div>
</body>
</html>
